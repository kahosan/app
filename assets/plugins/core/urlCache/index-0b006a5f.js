import{j as n,d as g}from"../../../index-021ad583.js";import{M as f,P as v,i as S,m,b}from"../../../messenger-provider-a886fcd3.js";import{c as C}from"../../../copyToClipboard-445aa5b6.js";import{d as x}from"../../../store-784602d5.js";import{c as y}from"../../../classnames-7ca44501.js";const c=jotai.atom({}),p="url-cache__topbar__save",j=()=>{const{editorInstance:e}=React.useContext(f)??{},s=React.useMemo(()=>e==null?void 0:e.getModel(),[e]),[t]=jotai.useAtom(c),r=React.useMemo(()=>{if(!s)return"disabled";const a=s.uri.toString(),o=t==null?void 0:t[a];return o===!0?"saved":o===!1?"save-needed":"disabled"},[s,t]);return n.jsx(v,{style:{order:-100},placement:"top",content:n.jsxs(n.Fragment,{children:["Save   ",n.jsxs("kbd",{children:[S?"⌘":"Ctrl"," + S"]})]}),offset:[0,6],children:n.jsxs("button",{className:y(p,r),onClick:()=>e==null?void 0:e.trigger("whatever","ppd.save",{}),children:[n.jsx("span",{className:"cldr codicon codicon-save"}),n.jsx("span",{className:`${p}-status`})]})})},i=jotai.getDefaultStore(),D=g({editor:{use:[()=>{const e=location.hash.slice(1),[s,t]=React.useState(e?decodeURIComponent(atob(e)):'console.log("Hello world!")');return React.useEffect(()=>{function r(){const a=location.hash.slice(1);t(a?decodeURIComponent(atob(a)):"")}return addEventListener("hashchange",r),()=>removeEventListener("hashchange",r)},[]),{code:s,setCode:t}}],load(e,s){var a;const t=(a=e.getModel())==null?void 0:a.uri.toString();t&&i.set(c,{...i.get(c),[t]:!0}),e.addAction({id:"ppd.save",label:"Save code to url",run(o){var h;const d=(h=o.getModel())==null?void 0:h.uri.toString();if(!d){m.then(l=>l.display("error",""));return}const u=o.getValue();history.pushState(null,"","#"+btoa(encodeURIComponent(u))),C(location.href),x("add",{code:u,cursor:o.getPosition()??void 0}),m.then(l=>l.display("success","Saved to clipboard, you can share it to your friends!")),o.focus(),i.set(c,{...i.get(c),[d]:!0})}}),e.addCommand(s.KeyMod.CtrlCmd|s.KeyCode.KeyS,()=>{e.trigger("whatever","ppd.save",{})});const r=b();e.onDidChangeModelContent(async()=>{await r(100);const o=e.getModel();if(!o)return;const d=o.uri.toString();i.set(c,{...i.get(c),[d]:!1})})},topbar:[j]}});export{D as _};
